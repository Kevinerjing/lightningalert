<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Hockey Strategy Visualizer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS to ensure smooth transitions on SVG elements */
        .player-circle {
            transition: transform 700ms ease-in-out;
        }
        /* Custom font */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="p-4 sm:p-6 md:p-8 min-h-screen">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 border-b-4 border-red-500 pb-2">
            Interactive Hockey Forward Strategies
        </h1>

        <div id="strategy-buttons" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
            <!-- Buttons will be injected here by JavaScript -->
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-2xl ring-4 ring-red-100">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                <h2 id="strategy-title" class="text-2xl font-semibold text-red-700 mb-2 sm:mb-0"></h2>
                <div class="text-sm font-medium text-gray-500">
                    Animation Step: <span id="current-step" class="text-red-600 font-bold"></span>
                </div>
            </div>

            <!-- Legend -->
            <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm mb-4 p-2 bg-gray-100 rounded-lg">
                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-600 mr-2"></span> Forwards (F)</span>
                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#1f2937] mr-2"></span> Offensive Defense (D1, D2)</span>
                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#2563eb] mr-2"></span> Opposing Defense (OD1, OD2)</span>
                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#10b981] mr-2"></span> Goalie (G)</span>
                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-black mr-2"></span> Puck</span>
            </div>

            <!-- Rink Visualizer Container -->
            <div id="rink-container" class="mb-6">
                <!-- SVG will be injected here -->
            </div>

            <!-- Description -->
            <p class="text-gray-700 text-lg leading-relaxed border-t pt-4 mt-4">
                <span class="font-semibold text-red-700">Description:</span> <span id="strategy-description"></span>
            </p>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const RINK_W = 800;
        const RINK_H = 400;
        const CENTER_Y = RINK_H / 2;
        const NET_X = RINK_W * 0.9;
        const NET_Y = CENTER_Y;
        const BLUE_LINE_X = RINK_W * 0.7;

        // Player/Puck visualization settings
        const PLAYER_R = 12;
        const PUCK_R = 6;
        const COLOR_F = '#dc2626'; // Red (Forwards - Offensive Team)
        const COLOR_D_OFF = '#1f2937'; // Very Dark Gray (Offensive Defense - Points)
        const COLOR_D_OPP = '#2563eb'; // Blue (Opposing Defense)
        const COLOR_G = '#10b981'; // Green (Goalie)
        const COLOR_PUCK = '#000000';

        // --- State Variables ---
        let currentPositions = {};
        let activeStrategyKey = 'gretzky_office';
        let isAnimating = false;
        let currentStep = 0;

        // --- Initial Positions ---
        const initialPositions = {
            F1: { x: NET_X - 100, y: CENTER_Y + 40, label: 'F1', color: COLOR_F },
            F2: { x: NET_X - 50, y: CENTER_Y - 50, label: 'F2', color: COLOR_F },
            F3: { x: NET_X - 150, y: CENTER_Y, label: 'F3', color: COLOR_F },
            D1: { x: BLUE_LINE_X + 20, y: CENTER_Y + 100, label: 'D1', color: COLOR_D_OFF },
            D2: { x: BLUE_LINE_X + 20, y: CENTER_Y - 100, label: 'D2', color: COLOR_D_OFF },
            G: { x: NET_X, y: NET_Y, label: 'G', color: COLOR_G },
            Puck: { x: NET_X - 150, y: CENTER_Y, color: COLOR_PUCK },
            OD1: { x: NET_X - 40, y: CENTER_Y + 20, label: 'OD1', color: COLOR_D_OPP },
            OD2: { x: NET_X - 70, y: CENTER_Y - 10, label: 'OD2', color: COLOR_D_OPP },
        };

        // --- Strategy Definitions ---
        const strategies = {
            gretzky_office: {
                title: "1. Behind the Net: Gretzkyâ€™s Office Play",
                description: "F3 carries the puck behind the net ('Gretzky's Office'). F3 then curls wide to the goal line extension to open a clear passing lane before delivering a 'Low Bump' pass to F1. F1 steps into the high-danger slot for a quick shot. OD1 shifts to cover the strong side post.",
                steps: [
                    { time: 500, updates: { 
                        F3: { x: NET_X + 50, y: CENTER_Y + 10 }, 
                        Puck: { x: NET_X + 50, y: CENTER_Y + 10 },
                        G: { x: NET_X - 5, y: CENTER_Y + 5 },
                        OD1: { x: NET_X - 5, y: CENTER_Y + 30 } 
                    } }, 
                    { time: 1000, updates: { 
                        F1: { x: NET_X - 80, y: CENTER_Y + 10 },
                        OD2: { x: NET_X - 50, y: CENTER_Y } 
                    } }, 
                    { time: 2000, updates: { 
                        F3: { x: NET_X - 10, y: CENTER_Y + 80 },
                        Puck: { x: NET_X - 10, y: CENTER_Y + 80 }
                    } },
                    { time: 2500, updates: { 
                        Puck: { x: NET_X - 80, y: CENTER_Y + 10 },
                        G: { x: NET_X, y: CENTER_Y }
                    } }, 
                    { time: 3000, updates: { Puck: { x: NET_X, y: NET_Y + 15 } } },
                ],
            },
            cycle_reverse: {
                title: "2. Behind-the-Net Cycle & Reverse Pass",
                description: "F1 carries the puck low, passes to F3 behind the net (Reverse Pass). F3 cycles the puck out to D1 (Point), creating space and a 'Low-to-High' scoring chance. D1 then shoots. The Opposing Defense (OD1/OD2) collapse down to contain F1 and F3.",
                steps: [
                    { time: 500, updates: { 
                        Puck: { x: NET_X - 50, y: CENTER_Y + 120 }, 
                        F1: { x: NET_X - 50, y: CENTER_Y + 120 },
                        OD1: { x: NET_X - 5, y: CENTER_Y + 80 },
                    } },
                    { time: 1000, updates: { 
                        F1: { x: NET_X + 50, y: CENTER_Y + 40 }, 
                        Puck: { x: NET_X + 50, y: CENTER_Y + 40 },
                        OD2: { x: NET_X - 50, y: CENTER_Y - 50 }
                    } },
                    { time: 1500, updates: { F3: { x: NET_X - 50, y: CENTER_Y + 90 }, G: { x: NET_X - 5, y: CENTER_Y - 5 } } }, 
                    { time: 2000, updates: { Puck: { x: NET_X - 50, y: CENTER_Y + 90 } } },
                    { time: 2500, updates: { 
                        Puck: { x: initialPositions.D1.x, y: initialPositions.D1.y },
                        OD1: { x: NET_X - 50, y: CENTER_Y + 10 },
                        OD2: { x: NET_X - 100, y: CENTER_Y - 10 },
                    } },
                    { time: 3000, updates: { Puck: { x: NET_X, y: NET_Y + 5 } } },
                ],
            },
            screen_tip_rebound: {
                title: "3. Net-Front: Screen, Tip, & Rebound",
                description: "D1 takes a shot from the point. F3 establishes a strong screen in front of G. F1 or F2 tip the puck, or pounce on the rebound. The Opposing Defense (OD1/OD2) try to box out F3 and F1.",
                steps: [
                    { time: 100, updates: { 
                        F3: { x: NET_X - 25, y: CENTER_Y + 5 },
                        OD1: { x: NET_X - 35, y: CENTER_Y + 15 },
                        OD2: { x: NET_X - 40, y: CENTER_Y - 15 },
                    } }, 
                    { time: 500, updates: { Puck: { x: NET_X, y: NET_Y + 5 } } }, 
                    { time: 1000, updates: { 
                        F1: { x: NET_X - 5, y: CENTER_Y + 20 },
                        OD1: { x: NET_X - 10, y: CENTER_Y + 30 },
                    } }, 
                    { time: 1500, updates: { Puck: { x: NET_X + 5, y: CENTER_Y + 10 } } }, 
                ],
            },
            net_front_triangle: {
                title: "4. Net-Front: Triangle Pass Play",
                description: "A rapid tic-tac-toe sequence: D1 (Point) passes to F1 (Strong Side). F1 immediately sends a cross-crease pass to F2 (Far Side/Backdoor) for a tap-in, beating the goalie's horizontal movement. OD1 tries to intercept the pass from F1.",
                steps: [
                    { time: 500, updates: { 
                        Puck: { x: initialPositions.F1.x, y: initialPositions.F1.y },
                        OD1: { x: NET_X - 60, y: CENTER_Y + 50 }
                    } }, 
                    { time: 1000, updates: { 
                        F2: { x: NET_X - 10, y: CENTER_Y - 30 },
                        OD2: { x: NET_X - 50, y: CENTER_Y - 50 } 
                    } }, 
                    { time: 1500, updates: { Puck: { x: NET_X - 10, y: CENTER_Y - 30 } } }, 
                    { time: 2000, updates: { 
                        Puck: { x: NET_X + 5, y: NET_Y - 5 },
                        G: { x: NET_X - 10, y: NET_Y - 15 }
                    } }, 
                ],
            },
            backdoor_play: {
                title: "5. Backdoor Play",
                description: "F3 carries the puck wide on the strong side, drawing D1's attention. F2 skates undetected (backdoor) on the far side of the net. F3 slides a quick pass across the crease (through the seam) to F2 for an easy tap-in. OD2 fails to recognize the backdoor cut.",
                steps: [
                    { time: 100, updates: { Puck: { x: initialPositions.F3.x, y: initialPositions.F3.y } } },
                    { time: 500, updates: { 
                        F3: { x: BLUE_LINE_X + 40, y: CENTER_Y - 150 }, 
                        Puck: { x: BLUE_LINE_X + 40, y: CENTER_Y - 150 },
                        OD1: { x: NET_X - 50, y: CENTER_Y - 50 }
                    } },
                    { time: 1000, updates: { F2: { x: NET_X - 10, y: CENTER_Y + 40 } } },
                    { time: 2000, updates: { Puck: { x: NET_X - 10, y: CENTER_Y + 40 }, OD1: { x: NET_X - 100, y: CENTER_Y + 50 } } },
                    { time: 2500, updates: { Puck: { x: NET_X + 5, y: NET_Y + 20 }, G: { x: NET_X - 10, y: NET_Y - 10 } } },
                ],
            },
            d_to_d_one_timer: {
                title: "6. Point Play: F3 to D2 to D1 Shot", 
                description: "F3 makes a stretch pass to D2 on the weak side. D2 immediately passes across the blue line to D1, who takes a quick shot. F3 moves to screen the goalie (G) during the sequence. OD1/OD2 stay low to screen the goalie and look for a rebound.", 
                steps: [
                    { time: 500, updates: { 
                        Puck: { x: initialPositions.D2.x, y: initialPositions.D2.y },
                        F3: { x: NET_X - 25, y: CENTER_Y + 5 },
                        OD1: { x: NET_X - 30, y: CENTER_Y + 20 },
                        OD2: { x: NET_X - 30, y: CENTER_Y - 20 }
                    } },
                    { time: 1000, updates: { Puck: { x: initialPositions.D1.x, y: initialPositions.D1.y } } }, 
                    { time: 1500, updates: { Puck: { x: NET_X, y: NET_Y + 10 }, G: { x: NET_X - 5, y: CENTER_Y } } }, 
                ],
            },
        };

        // --- Helper Functions ---

        /**
         * Renders a single player or the puck as an SVG group element.
         * @param {Object} pos - The position object {x, y, label, color}
         * @param {string} id - The ID of the player (e.g., 'F1', 'Puck')
         * @returns {string} SVG group string
         */
        function PlayerCircle(pos, id) {
            const isPuck = id === 'Puck';
            const r = isPuck ? PUCK_R : PLAYER_R;
            const labelText = isPuck ? '' : `<text x="0" y="5" font-size="10" font-weight="bold" fill="white" text-anchor="middle" class="pointer-events-none select-none">${pos.label}</text>`;
            
            return `
                <g id="${id}-group" transform="translate(${pos.x}, ${pos.y})" class="player-circle">
                    <circle r="${r}" fill="${pos.color}" />
                    ${labelText}
                </g>
            `;
        }

        /**
         * Renders the static rink and then all players/puck.
         * @param {Object} positions - Current positions of all elements.
         */
        function renderRink(positions) {
            const rinkContainer = document.getElementById('rink-container');
            const CENTER_X = RINK_W / 2;

            const DrawLine = (x1, y1, x2, y2, color, stroke = '4') => 
                `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-width="${stroke}" />`;
            
            const DrawCircle = (cx, cy, r, color, fill = 'none', stroke = '2') => 
                `<circle cx="${cx}" cy="${cy}" r="${r}" fill="${fill}" stroke="${color}" stroke-width="${stroke}" />`;

            const DrawGoalCrease = () => 
                `<path d="M ${NET_X - 5} ${CENTER_Y + 45} A 45 45 0 0 0 ${NET_X - 5} ${CENTER_Y - 45} L ${NET_X - 5} ${CENTER_Y + 45}" 
                      fill="none" stroke="#e02626" stroke-width="3" />`;

            let svgContent = `
                <svg viewBox="0 0 ${RINK_W} ${RINK_H}" class="w-full h-auto bg-[#c8e6f0] border-2 border-black rounded-lg shadow-xl">
                    <!-- Rink Lines -->
                    ${DrawLine(RINK_W / 2, 0, RINK_W / 2, RINK_H, "#e02626")}
                    ${DrawLine(RINK_W * 0.3, 0, RINK_W * 0.3, RINK_H, "#2563eb")}
                    ${DrawLine(BLUE_LINE_X, 0, BLUE_LINE_X, RINK_H, "#2563eb")}
                    ${DrawCircle(CENTER_X, CENTER_Y, 30, "#e02626")}
                    ${DrawCircle(RINK_W * 0.8, RINK_H * 0.25, 3, "#e02626", "#e02626")}
                    ${DrawCircle(RINK_W * 0.8, RINK_H * 0.75, 3, "#e02626", "#e02626")}

                    <!-- Goal Net -->
                    <rect x="${NET_X}" y="${NET_Y - 30}" width="20" height="60" fill="#a0a0a0" stroke="white" stroke-width="2" />
                    ${DrawGoalCrease()}

                    <!-- Players and Puck Container -->
                    <g id="players-container">
                        ${Object.keys(positions).map(key => PlayerCircle(positions[key], key)).join('')}
                    </g>
                </svg>
            `;

            rinkContainer.innerHTML = svgContent;
        }

        /**
         * Updates the position of a single element (player or puck) by manipulating its SVG transform attribute.
         * @param {string} id - The ID of the element (e.g., 'F1', 'Puck')
         * @param {Object} pos - The new position {x, y}
         */
        function updateElementPosition(id, pos) {
            const element = document.getElementById(`${id}-group`);
            if (element) {
                element.setAttribute('transform', `translate(${pos.x}, ${pos.y})`);
            }
        }

        /**
         * The main animation loop.
         * @param {string} strategyKey - The key of the strategy to run.
         */
        async function runAnimation(strategyKey) {
            if (isAnimating) return;
            isAnimating = true;
            currentStep = 0;
            
            // 1. Reset positions and UI
            currentPositions = JSON.parse(JSON.stringify(initialPositions));
            Object.keys(currentPositions).forEach(key => {
                updateElementPosition(key, currentPositions[key]);
            });
            
            updateUI(strategyKey);
            document.querySelectorAll('#strategy-buttons button').forEach(btn => btn.disabled = true);
            
            await new Promise(resolve => setTimeout(resolve, 700)); // Delay for reset visibility

            const currentStrategy = strategies[strategyKey];

            // 2. Execute steps
            for (let i = 0; i < currentStrategy.steps.length; i++) {
                const step = currentStrategy.steps[i];
                currentStep = i + 1;
                
                // Apply movement updates
                for (const key in step.updates) {
                    currentPositions[key] = { ...currentPositions[key], ...step.updates[key] };
                    updateElementPosition(key, currentPositions[key]);
                }
                
                // Update step counter
                document.getElementById('current-step').textContent = `${currentStep} / ${currentStrategy.steps.length}`;

                // Wait for the step duration
                await new Promise(resolve => setTimeout(resolve, step.time));
            }

            isAnimating = false;
            document.querySelectorAll('#strategy-buttons button').forEach(btn => btn.disabled = false);
        }

        /**
         * Updates the title and description in the UI.
         * @param {string} key - The strategy key.
         */
        function updateUI(key) {
            const strat = strategies[key];
            document.getElementById('strategy-title').textContent = strat.title;
            document.getElementById('strategy-description').textContent = strat.description;
            document.getElementById('current-step').textContent = `0 / ${strat.steps.length}`;
        }

        /**
         * Handles the button click event.
         * @param {string} key - The strategy key.
         */
        function handleStrategyClick(key) {
            if (key !== activeStrategyKey) {
                activeStrategyKey = key;
                // De-highlight old button and highlight new one
                document.querySelector(`#strategy-buttons button.bg-red-600`)?.classList.replace('bg-red-600', 'bg-white');
                document.querySelector(`#strategy-buttons button.bg-white`)?.classList.replace('text-white', 'text-gray-700');
                document.querySelector(`#strategy-buttons button.bg-white`)?.classList.replace('font-bold', 'font-normal');
                document.querySelector(`#strategy-buttons button.ring-4`)?.classList.remove('ring-4', 'ring-red-300');
                document.querySelector(`#strategy-buttons button.border-4`)?.classList.replace('border-4', 'border-2');
                
                const newButton = document.getElementById(`btn-${key}`);
                newButton.classList.replace('bg-white', 'bg-red-600');
                newButton.classList.replace('text-gray-700', 'text-white');
                newButton.classList.add('font-bold', 'ring-4', 'ring-red-300');
                newButton.classList.replace('border-2', 'border-4');
            }
            runAnimation(key);
        }

        /**
         * Initializes the buttons and sets up the first strategy display.
         */
        function initializeApp() {
            // Render buttons
            const buttonsContainer = document.getElementById('strategy-buttons');
            Object.entries(strategies).forEach(([key, strat]) => {
                const isSelected = key === activeStrategyKey;
                const button = document.createElement('button');
                button.id = `btn-${key}`;
                button.textContent = strat.title;
                button.onclick = () => handleStrategyClick(key);
                button.className = `
                    p-4 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.02]
                    text-left text-sm sm:text-base border-2 border-gray-300
                    ${isSelected 
                        ? 'bg-red-600 text-white font-bold border-4 border-red-800 ring-4 ring-red-300' 
                        : 'bg-white text-gray-700 hover:bg-gray-100'
                    }
                `;
                buttonsContainer.appendChild(button);
            });

            // Initialize visual state
            currentPositions = JSON.parse(JSON.stringify(initialPositions));
            renderRink(currentPositions);
            updateUI(activeStrategyKey);
            
            // Start the first animation
            runAnimation(activeStrategyKey);
        }

        // Run initialization when the page is fully loaded
        window.onload = initializeApp;
    </script>
</body>
</html>