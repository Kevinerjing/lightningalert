<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hockey Tactics Board (Mobile Friendly)</title>
<style>
  body {
    background: #e9f4ff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 20px;
  }

  #hint {
    margin-bottom: 10px;
    font-size: 14px;
    text-align: center;
  }

  #rink {
    width: 420px;
    height: 260px;
    background: #ffffff;
    border: 4px solid #007bff;   /* rink border */
    border-radius: 22px;
    position: relative;
    overflow: hidden;
    touch-action: none; /* prevent scroll during drag */
  }

  /* Goal Crease (top blue semicircle) */
  #crease {
    position: absolute;
    top: 4px;
    left: 170px;
    width: 80px;
    height: 50px;
    background: rgba(0,150,255,0.25);
    border-radius: 40px 40px 0 0;
    border: 2px solid #007bff;
    border-bottom: none;
    cursor: crosshair;
  }

  /* Faceoff circles */
  .faceoff-circle {
    position: absolute;
    width: 70px;
    height: 70px;
    border: 2px solid #d40000;
    border-radius: 50%;
  }
  #leftCircle  { top: 95px; left: 65px; }
  #rightCircle { top: 95px; right: 65px; }

  .faceoff-dot {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #d40000;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .hash {
    position: absolute;
    width: 14px;
    height: 2px;
    background: #d40000;
  }
  .hash-left-top  { top: 28%; left: -8px; }
  .hash-left-bot  { top: 72%; left: -8px; }
  .hash-right-top { top: 28%; right: -8px; }
  .hash-right-bot { top: 72%; right: -8px; }

  /* Blue line */
  #blueLine {
    position: absolute;
    bottom: 60px;
    left: 0;
    width: 100%;
    height: 3px;
    background: #007bff;
  }

  /* Players */
  .player {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    position: absolute;
    font-size: 11px;
    font-weight: bold;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: grab;
    text-shadow: 0 0 2px black;
    transition: left 0.3s linear, top 0.3s linear;
    user-select: none;
  }
  #F1, #F2, #F3 { background:#007bff; }
  #D1, #D2      { background:#cc0000; }

  #G {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background:#555;
    color:#fff;
    position:absolute;
    display:flex;
    justify-content:center;
    align-items:center;
    transition:left 0.3s linear, top 0.3s linear;
  }

  #puck {
    width:8px;
    height:8px;
    background:#000;
    border-radius:50%;
    position:absolute;
    transition:left 0.2s linear, top 0.2s linear;
  }

  /* Passing highlight */
  .selected {
    box-shadow: 0 0 0 3px yellow;
  }

  /* Goal text */
  #goalText {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 20px;
    font-weight: bold;
    color: #007bff;
    text-shadow: 0 0 4px #ffffff;
    opacity: 0;
    transition: opacity 0.3s;
  }
</style>
</head>
<body>

<div id="hint">
  Drag the players to any position you want. The current puck carrier is F1.<br>
  <b>Pass:</b> Tap the puck carrier, then tap a teammate.<br>
  <b>Shoot:</b> Tap puck carrier, then tap the blue goal crease.
</div>
<div id="hint">...</div>
<button id="autoPlayBtn">Run F1 → F2 → F3</button>

<div id="rink">
  <!-- Goal crease -->
  <div id="crease"></div>

  <!-- Faceoff circles -->
  <div class="faceoff-circle" id="leftCircle">
    <div class="faceoff-dot"></div>
    <div class="hash hash-left-top"></div>
    <div class="hash hash-left-bot"></div>
    <div class="hash hash-right-top"></div>
    <div class="hash hash-right-bot"></div>
  </div>

  <div class="faceoff-circle" id="rightCircle">
    <div class="faceoff-dot"></div>
    <div class="hash hash-left-top"></div>
    <div class="hash hash-left-bot"></div>
    <div class="hash hash-right-top"></div>
    <div class="hash hash-right-bot"></div>
  </div>

  <div id="blueLine"></div>

  <!-- Players -->
  <div class="player" id="F1">F1</div>
  <div class="player" id="F2">F2</div>
  <div class="player" id="F3">F3</div>
  <div class="player" id="D1">D1</div>
  <div class="player" id="D2">D2</div>
  <div id="G">G</div>

  <!-- Puck & Goal Text -->
  <div id="puck"></div>
  <div id="goalText">GOAL!</div>
</div>

<script>
  const rink   = document.getElementById("rink");
  const crease = document.getElementById("crease");
  const F1     = document.getElementById("F1");
  const F2     = document.getElementById("F2");
  const F3     = document.getElementById("F3");
  const D1     = document.getElementById("D1");
  const D2     = document.getElementById("D2");
  const G      = document.getElementById("G");
  const puck   = document.getElementById("puck");
  const goalText = document.getElementById("goalText");

  const players = [F1, F2, F3, D1, D2, G];

  let currentHolder = F1;
  let selectedFrom = null;

  let dragging = null;
  let dragMoved = false;
  let offsetX = 0, offsetY = 0;

  function setPos(el, x, y) {
    el.style.left = x + "px";
    el.style.top  = y + "px";
  }

  function getCenter(el) {
    const x = parseInt(el.style.left) || 0;
    const y = parseInt(el.style.top)  || 0;
    return {
      cx: x + el.offsetWidth/2,
      cy: y + el.offsetHeight/2
    };
  }

  function syncPuck(noTransition) {
    const { cx, cy } = getCenter(currentHolder);
    if (noTransition) {
      puck.style.transition = "none";
      setPos(puck, cx - 4, cy - 4);
      requestAnimationFrame(() =>
        puck.style.transition = "left 0.2s linear, top 0.2s linear"
      );
    } else {
      setPos(puck, cx - 4, cy - 4);
    }
  }

  function initPositions() {
    setPos(G, 197, 18);
    setPos(D1, 215, 70);
    setPos(D2, 175, 70);
    setPos(F1, 260, 190);
    setPos(F2, 220, 160);
    setPos(F3, 300, 160);
    currentHolder = F1;
    syncPuck(true);
  }

  /* ---------------- Mouse Drag ---------------- */
  players.forEach(p =>
    p.addEventListener("mousedown", e => {
      dragging = p;
      dragMoved = false;
      p.style.transition = "none";
      if (p === currentHolder) puck.style.transition = "none";

      offsetX = e.offsetX;
      offsetY = e.offsetY;
      e.preventDefault();
    })
  );

  document.addEventListener("mousemove", e => {
    if (!dragging) return;
    dragMoved = true;

    const rect = rink.getBoundingClientRect();
    let x = e.clientX - rect.left - offsetX;
    let y = e.clientY - rect.top - offsetY;

    x = Math.max(0, Math.min(rect.width - dragging.offsetWidth, x));
    y = Math.max(0, Math.min(rect.height - dragging.offsetHeight, y));

    setPos(dragging, x, y);
    if (dragging === currentHolder) syncPuck(true);
  });

  document.addEventListener("mouseup", () => {
    if (dragging) {
      dragging.style.transition = "left 0.3s, top 0.3s";
      puck.style.transition = "left 0.2s, top 0.2s";
    }
    dragging = null;
  });

  /* ---------------- Touch Drag (Mobile) ---------------- */
  players.forEach(p =>
    p.addEventListener("touchstart", e => {
      const t = e.touches[0];
      dragging = p;
      dragMoved = false;
      p.style.transition = "none";
      if (p === currentHolder) puck.style.transition = "none";

      const rect = p.getBoundingClientRect();
      offsetX = t.clientX - rect.left;
      offsetY = t.clientY - rect.top;

      e.preventDefault();
    })
  );

  document.addEventListener("touchmove", e => {
    if (!dragging) return;
    dragMoved = true;

    const t = e.touches[0];
    const rect = rink.getBoundingClientRect();
    let x = t.clientX - rect.left - offsetX;
    let y = t.clientY - rect.top - offsetY;

    x = Math.max(0, Math.min(rect.width - dragging.offsetWidth, x));
    y = Math.max(0, Math.min(rect.height - dragging.offsetHeight, y));

    setPos(dragging, x, y);
    if (dragging === currentHolder) syncPuck(true);

    e.preventDefault();
  });

  document.addEventListener("touchend", () => {
    if (dragging) {
      dragging.style.transition = "left 0.3s, top 0.3s";
      puck.style.transition = "left 0.2s, top 0.2s";
    }
    dragging = null;
  });

  /* ---------------- Passing Logic ---------------- */
  players.forEach(p =>
    p.addEventListener("click", () => {
      if (dragMoved) return; // ignore tap after drag

      if (!selectedFrom) {
        if (p === currentHolder) {
          selectedFrom = p;
          p.classList.add("selected");
        }
        return;
      }

      if (p === selectedFrom) {
        selectedFrom.classList.remove("selected");
        selectedFrom = null;
        return;
      }

      currentHolder = p;
      syncPuck(false);

      selectedFrom.classList.remove("selected");
      selectedFrom = null;
    })
  );

  /* ---------------- Shooting Logic ---------------- */
  crease.addEventListener("click", () => {
    if (!selectedFrom) return;

    const rinkRect = rink.getBoundingClientRect();
    const cRect = crease.getBoundingClientRect();

    const gx = cRect.left - rinkRect.left + cRect.width / 2;
    const gy = cRect.top - rinkRect.top + cRect.height / 2;

    setPos(puck, gx - 4, gy - 4);

    goalText.style.opacity = 1;
    setTimeout(() => (goalText.style.opacity = 0), 800);

    selectedFrom.classList.remove("selected");
    selectedFrom = null;
  });

  initPositions();

// =============================
// AUTO PLAY: F1 → F2 → F3
// =============================
document.getElementById("autoPlayBtn").addEventListener("click", () => {
  // Step 1 — pass from F1 → F2
  selectedFrom = F1;
  currentHolder = F1;
  syncPuck(true);

  setTimeout(() => {
    passPuckTo(F2);
  }, 400);

  // Step 2 — pass F2 → F3
  setTimeout(() => {
    selectedFrom = F2;
    currentHolder = F2;
    syncPuck(true);
    passPuckTo(F3);
  }, 900);

  // Step 3 — cleanup
  setTimeout(() => {
    selectedFrom = null;
  }, 1400);
});

</script>

</body>
</html>
